---
format: gfm
---

## Reading in the Data

Below shows the code I used to read in the data, where each song is its own csv file. I then created columns for the metadata associated with each song. 

```{r}

#reading in packages I will need
library(tidyverse)
library(dplyr)
library(stringr)
library(tidytext)

# Path to the subfolder
data_subfolder <- "Seventeen_Lyrics"

# Get full file paths of all CSVs in the subfolder
files <- list.files(path = data_subfolder, pattern = "\\.csv$", full.names = TRUE)
firstfiles <- read_csv(files,id = "file", na = c("", "na", "n/a", "N/A", "NA", "Na"))

# Read all CSVs into a list of data frames
# <- read_csv(id = "file", na = c("", "na", "n/a", "N/A", "NA", "Na"))


#firstfiles$file = as.character(file)
firstfiles$track_type = str_extract(firstfiles$file, "Title|Nontitle")
firstfiles$album_year = str_extract(firstfiles$file, "15|20|23|24")

 
#separating out the song names using str_detect and mutate functions
lyrics = firstfiles |>
  mutate(
    file = as.character(file),
  song_title = case_when(
    str_detect(file, "Nontitle_Ah_Yeah_15.csv") ~ "Ah Yeah",
    str_detect(file, "Nontitle_April_shower_23.csv") ~ "April Shower",
    str_detect(file, "Nontitle_Candy_24.csv") ~ "Candy",
    str_detect(file, "Nontitle_Dust_23.csv") ~ "Dust",
    str_detect(file, "Nontitle_Eyes_On_You_24.csv") ~ "Eyes On You",
    str_detect(file, "Nontitle_F_ck_My_Life_23.csv") ~ "F_ck My Life",
    str_detect(file, "Nontitle_Fearless_20.csv") ~ "Fearless",
    str_detect(file, "Nontitle_Fire_23.csv") ~ "Fire",
    str_detect(file, "Nontitle_I_Dont_Understand_But_I_Luv_U_23.csv") ~ "I Don't Understand But I Luv U",
    str_detect(file, "Nontitle_I_Wish_20.csv") ~ "I Wish",
    str_detect(file, "Nontitle_Jam_Jam_15.csv") ~ "Jam Jam",
    str_detect(file, "Nontitle_Kidult_20.csv") ~ "Kidult",
    str_detect(file, "Nontitle_My_My_20.csv") ~ "My My",
    str_detect(file, "Nontitle_Rain_24.csv") ~ "Rain",
    str_detect(file, "Nontitle_Shining_Diamond_15.csv") ~ "Shining Diamond",
    str_detect(file, "Nontitle_Together_20.csv") ~ "Together",
    str_detect(file, "Nontitle_Twenty_15.csv") ~ "Twenty",
    str_detect(file, "Nontitle_Water_24.csv") ~ "Water",
    str_detect(file, "Title_Adore_U_15.csv") ~ "Adore U",
    str_detect(file, "Title_Left_and_Right_20.csv") ~ "Left and Right",
    str_detect(file, "Title_Love_Money_Fame_24.csv") ~ "Love Money Fame",
    str_detect(file, "Title_One_to_Thirteen_24.csv") ~ "One to Thirteen",
    str_detect(file, "Title_Super_23.csv") ~ "Super"),
  #reformatting the year of each album to be written out fully
  album_year = case_when(
    str_detect(album_year, "24") ~ "2024",
    str_detect(album_year, "23") ~ "2023",
    str_detect(album_year, "20") ~ "2020",
    str_detect(album_year, "15") ~ "2015")
  ) ->> lyrics

colnames(lyrics) <- tolower(colnames(lyrics))
lyrics
```

## Tidying the Data 

After reading in the individual files of each song and creating neat columns for the metadata related to each song, I end up with a tidy dataframe called "lyrics":

```{r}
lyrics 
```

With this "lyrics" dataframe, I can then pivot the data to be longer, making each word of the song lyrics its own row:
```{r}
#putting each word of the lyrics as its own row and feeding it back into the dataframe
lyrics |> 
  unnest_tokens(word, "lyrics") |> arrange(desc(album_year)) -> lyrics
lyrics

```
### Language Detection

Now that each word can be evaluated separately, I can detect the language of the word. Because Korean and English use separate alphabets, I simply used stringr functions to detect Hangul versus Latin alphabet use in each word. A new column was created to hold the information on the language of the words. The mutated "lyrics" dataframe that contains this new column was renamed to "lyricsdf".

```{r}
#mutating the dataframe to detect language of rows of lyrics and create language column
lyricdf <- lyrics |>
  mutate(
    word   = as.character(word),
  language = case_when(
  str_detect(word, "[가-힣]") ~ "Korean",
  str_detect(word, "[a-zA-z 12345]") ~ "English"
)) ->> lyricsdf
  
lyricsdf

```

## Visualizing and Analyzing the Data

### Language Use Overview
With the lyrics parsed and the language use detected, I could move on to considering the data as a whole. 

The language breakdown of the lyrics altogether lean majority Korean: 

```{r}
#to count the language breakdown of the lyrics overall
lyricsdf |> count(language, sort=TRUE)

#...and visualize it:
ggplot(data=subset(lyricsdf, !is.na(language)), aes(x = language)) +
  geom_bar(fill = "salmon")+ theme_light() + xlab("Language") + ylab("Count") + labs(title = "Overall Language Use")
ggsave("Overall Language Use.png")
```

### Language Use by Album 

However, it is more important to view the lyrics based off of **when** they were released. One of the goals of this research was to investigate whether language use changes over time and/or as their popularity rises. Both a total count view and a percentage view is provided so that the language variation within and across each album. 

```{r}
#code meant to count the language breakdown of lyrics by album
table(lyricsdf$album_year, lyricsdf$language)

#...and visualize it:
ggplot(data=subset(lyricsdf, !is.na(language)), aes(x = language, fill = album_year, na.rm = FALSE)) +
  geom_bar(position = "dodge") + xlab("Language") + ylab("Lyrics") + labs(fill = "Album Year")  + labs(title = "Language Use for Each Album Year")
ggsave("Language Use for Each Album Year.png")


ggplot(data=subset(lyricsdf, !is.na(language)), aes(x = album_year, fill = language)) +
  geom_bar(position = "fill") + xlab("Album Year") + ylab("Lyrics") + labs(fill = "Language") + labs(title = "Language Comparison by Album Year")
ggsave("Language Comparison by Album Year.png")

```
### Zooming in on Track Type

Some nuance is lost in this zoomed out view, so I also sorted the language use by song within each album. Then, I viewed the language use particularly of the "title" tracks of each album. 
```{r}
#sorting songs into albums:
filter(lyricsdf, album_year == "2024") ->> byalbum24
filter(lyricsdf, album_year == "2023") ->> byalbum23
filter(lyricsdf, album_year == "2020") ->> byalbum20
filter(lyricsdf, album_year == "2015") ->> byalbum15

#visualizing language use by album and song using objects from above ^: 
ggplot(data=subset(byalbum15, !is.na(language)), aes(y = song_title, fill = language)) +
  geom_bar(position = "fill") + xlab("Lyrics") + ylab("Songs") + labs(title= "Language Use for Debut (2015) Album")
ggsave("Language Use for Debut.png")

ggplot(data=subset(byalbum20, !is.na(language)), aes(y = song_title, fill = language)) +
  geom_bar(position = "fill") + xlab("Lyrics") + ylab("Songs") + labs(title= "Language Use for Mid-Career (2020) Album")
ggsave("Language Use for Mid-Career.png")

ggplot(data=subset(byalbum23, !is.na(language)), aes(y = song_title, fill = language)) +
  geom_bar(position = "fill") + xlab("Lyrics") + ylab("Songs") + labs(title= "Language Use for Best-selling (2023) Album")
ggsave("Language Use for Best-selling.png")

ggplot(data=subset(byalbum24, !is.na(language)), aes(y = song_title, fill = language)) +
  geom_bar(position = "fill") + xlab("Lyrics") + ylab("Songs") + labs(title= "Language Use for Latest (2024) Album")
ggsave("Language Use for Latest.png")

#filtering so that only the title tracks are included:
filter(lyricsdf, song_title == "Adore U") ->> debuttitle
filter(lyricsdf, song_title == "Left and Right") ->> midtitle
filter(lyricsdf, song_title == "Super") ->> bestitle
filter(lyricsdf, song_title == "Love Money Fame") ->> latesttitle


#visualizing the language breakdown of each title track:
ggplot(data=subset(debuttitle, !is.na(language)), aes(x = language, fill = language)) +
  geom_bar(position = "dodge") + xlab("Language of Lyrics") + ylab("Count") + labs(title= "Language Breakdown for 'Adore U' (2015)")

ggplot(data=subset(midtitle, !is.na(language)), aes(x = language, fill = language)) +
  geom_bar(position = "dodge") + xlab("Language of Lyrics") + ylab("Count") + labs(title= "Language Breakdown for 'Left and Right' (2020)")

ggplot(data=subset(bestitle, !is.na(language)), aes(x = language, fill = language)) +
  geom_bar(position = "dodge") + xlab("Language of Lyrics") + ylab("Count") + labs(title= "Language Breakdown for 'Super' (2023)")

ggplot(data=subset(latesttitle, !is.na(language)), aes(x = language, fill = language)) +
  geom_bar(position = "dodge") + xlab("Language of Lyrics") + ylab("Count") + labs(title= "Language Breakdown for 'Love, Money, Fame' (2024)")
```

### English Highlights

The data gets more interesting as we zoom into what English words are found in the songs. Below are snapshots of the English makeup of the four title tracks from the albums in this study:

```{r}
#taking a closer look at the English lyrics in each title track: 
filter(debuttitle, language == "English") ->> adoreu
filter(midtitle, language == "English") ->> leftright
filter(bestitle, language == "English") ->> super
filter(latesttitle, language == "English") ->> lovemoneyfame


#visualization for English lyrics in 2024 title track:
ggplot(data=subset(lovemoneyfame, !is.na(language)), aes(y = word, fill = word)) +
  geom_bar(position = "dodge") + xlab("Count") + ylab("English Words") + labs(title= "English Lyrics for 'Love, Money, Fame'") + theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
ggsave("English for 2024 Title.png")

#visualization for English lyrics in 2023 title track: 
ggplot(data=subset(super, !is.na(language)), aes(y = word, fill = word)) +
  geom_bar(position = "dodge") + xlab("Count") + ylab("English Words") + labs(title= "English Lyrics for 'Super'") + theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
ggsave("English for 2023 Title.png")

#visualization for English lyrics in 2020 title track: 
ggplot(data=subset(leftright, !is.na(language)), aes(y = word, fill = word)) +
  geom_bar(position = "dodge") + xlab("Count") + ylab("English Words") + labs(title= "English Lyrics for 'Left and Right'") + theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
ggsave("English for 2020 Title.png")

#visualization for English lyrics in 2015 title track: 
ggplot(data=subset(adoreu, !is.na(language)), aes(y = word, fill = word)) +
  geom_bar(position = "dodge") + xlab("Count") + ylab("English Words") + labs(title= "English Lyrics for 'Adore U'") + theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
ggsave("English for 2015 Title.png")

```


Do the later releases include more complex English structures than their early counterparts? This is a trend that can be confirmed by looking closer at English **function words**.

```{r}
#long list of common function words in English
stopwords <- c(
  "a","about","above","across","after","again","against","all","almost",
  "along","already","also","although","always","am","among","an","and",
  "another","any","anybody","anyone","anything","anywhere","are","around",
  "as","at","away","back","be","became","because","become","becomes",
  "been","before","being","below","between","both","but","by","can",
  "cannot","could","did","do","does","doing","done","down","during",
  "each","either","else","enough","even","ever","every","everybody",
  "everyone","everything","everywhere","few","fewer","for","from","further",
  "had","has","have","having","he","her","here","hers","herself","him",
  "himself","his","how","however","i","I", "if","in","inside","instead","into",
  "is","it","its","itself","just","least","less","let","like","likely",
  "little","long","may","me","might","more","most","mostly","much","must",
  "my","myself","near","neither","never","no","nobody","none","nor","not",
  "nothing","now","nowhere","of","off","often","on","once","one","only",
  "onto","or","other","others","otherwise","our","ours","ourselves","out",
  "outside","over","own","per","perhaps","please","quite","rather","really",
  "said","same","seem","seemed","seeming","seems","several","shall","she",
  "should","since","so","some","somebody","someone","something","sometimes",
  "somewhere","soon","still","such","than","that","the","their","theirs",
  "them","themselves","then","there","therefore","these","they","this",
  "those","though","through","throughout","thus","to","together","too",
  "toward","towards","under","until","up","upon","us","usually","very",
  "via","was","we","well","were","what","whatever","when","whenever",
  "where","wherever","whether","which","while","whilst","who","whoever",
  "whom","whomever","whose","why","will","with","within","without","would",
  "yes","yet","you","your","yours","yourself","yourselves"
)

#sorting the lyrics into function or content/other categories using the list above
lyric_wordtype <- lyricdf |>
  mutate(
    cont_func = if_else(
      word %in% stopwords,
      "Function",
      "Content/Other" ))
lyric_wordtype

#subset that only hold lyrics that are function words in English
function_subset <- filter(lyric_wordtype, cont_func == "Function")
function_subset

#counting the lyrics that match the function word list:
function_freq <- function_subset %>%
  count(song_title, cont_func, sort = TRUE)
function_freq

#checking that there aren't any function words labeled as content words:
content_subset <- filter(lyric_wordtype, language == "English", cont_func == "Content/Other")
content_subset

```

Interjections would also be classed as function words since they 'fill' pauses and express feeling or reaction in an utterance. Interjections in the data were not included in the list of function words above but were left as part of the "Content/Other" category.

```{r}
ggplot(data=subset(lyric_wordtype, !is.na(language)), aes(x = album_year, fill = cont_func)) +
  geom_bar(position = "fill") + xlab("Album Year") + ylab("Word Type") + labs(fill = "Language") + labs(title = "Word Type by Album Year")

ggsave("Word Type by Album Year.png")
```

```{r}
ggplot(data=subset(function_subset), aes(x = album_year, fill = cont_func)) +
  geom_bar(position = "dodge") + xlab("Count") + ylab("Function Words") + labs(title= "English Function Words by Year")
ggsave("Function Word Count by Album.png")




ggplot(data=subset(function_subset), aes(x = album_year, fill = word)) +
  geom_bar(position = "dodge") + xlab("Count") + ylab("Function Wordss") + labs(title= "English Function Words by Year") + theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
ggsave("English Function Words by Album Year.png")
```
